<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰«ç›˜å¤§ç‹ - ç¡¬ç›˜ç©ºé—´åˆ†æå·¥å…·</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    
    <!-- é…ç½®Tailwindé¢œè‰²å’Œå­—ä½“ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#10b981',
                        accent: '#f59e0b',
                        danger: '#ef4444',
                        dark: '#1f2937',
                        light: '#f3f4f6',
                        // å¤œé—´æ¨¡å¼ä¸“ç”¨é¢œè‰²
                        'dark-bg': '#0f172a',
                        'dark-surface': '#1e293b',
                        'dark-surface-hover': '#334155',
                        'dark-text': '#e2e8f0',
                        'dark-text-secondary': '#94a3b8',
                        'dark-border': '#334155',
                        'dark-primary': '#60a5fa',
                        'dark-secondary': '#34d399',
                        'dark-accent': '#fbbf24',
                        'dark-danger': '#f87171'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- è‡ªå®šä¹‰å·¥å…·ç±» -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            }
            .btn-primary {
                border: 2px solid #3b82f6;
            }
            .btn-primary:hover {
                border-color: #2563eb;
            }
            .btn-danger {
                border: 2px solid #ef4444;
            }
            .btn-danger:hover {
                border-color: #dc2626;
            }
            .dark-mode {
                background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
                color: #e2e8f0;
            }
            .dark-mode .glass-card {
                background: rgba(30, 41, 59, 0.7);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(51, 65, 85, 0.3);
                box-shadow: 0 8px 32px rgba(2, 8, 20, 0.4);
            }
            .dark-mode .glass-card:hover {
                background: rgba(30, 41, 59, 0.8);
                border: 1px solid rgba(71, 85, 105, 0.5);
            }
            .dark-mode .nav-glass {
                background: rgba(15, 23, 42, 0.9);
                backdrop-filter: blur(10px);
                border-bottom: 1px solid rgba(51, 65, 85, 0.3);
            }
            .dark-mode .text-glow {
                text-shadow: 0 0 10px rgba(96, 165, 250, 0.5);
            }
            .dark-mode .progress-glow {
                box-shadow: 0 0 10px rgba(96, 165, 250, 0.3);
            }
            .dark-mode .chart-container {
                background: rgba(30, 41, 59, 0.5);
                border-radius: 12px;
                padding: 1rem;
            }
            .dark-mode .table-row:hover {
                background: rgba(51, 65, 85, 0.4);
            }
            .dark-mode .form-input {
                background: rgba(30, 41, 59, 0.7);
                border: 1px solid rgba(51, 65, 85, 0.5);
                color: #e2e8f0;
            }
            .dark-mode .form-input:focus {
                border-color: #60a5fa;
                box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
            }
            .dark-mode .form-input::placeholder {
                color: #64748b;
            }
            .dark-mode .btn-primary {
                background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            }
            .dark-mode .btn-primary:hover {
                background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
                box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
            }
            .dark-mode .btn-danger {
                background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
            }
            .dark-mode .btn-danger:hover {
                background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
                box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
            }
            .dark-mode .legend-item {
                background: rgba(30, 41, 59, 0.6);
                border: 1px solid rgba(51, 65, 85, 0.3);
            }
            .dark-mode .legend-item:hover {
                background: rgba(51, 65, 85, 0.6);
                border-color: rgba(71, 85, 105, 0.5);
            }
            .dark-mode .modal-backdrop {
                background: rgba(0, 0, 0, 0.7);
            }
            .dark-mode .modal-content {
                background: rgba(30, 41, 59, 0.95);
                border: 1px solid rgba(51, 65, 85, 0.5);
                box-shadow: 0 25px 50px rgba(2, 8, 20, 0.5);
            }
            .dark-mode .status-indicator {
                background: rgba(30, 41, 59, 0.7);
                border: 1px solid rgba(51, 65, 85, 0.3);
            }
            .dark-mode .status-indicator.active {
                background: rgba(16, 185, 129, 0.2);
                border-color: rgba(52, 211, 153, 0.5);
                box-shadow: 0 0 10px rgba(52, 211, 153, 0.3);
            }
            .dark-mode .status-indicator.error {
                background: rgba(239, 68, 68, 0.2);
                border-color: rgba(248, 113, 113, 0.5);
                box-shadow: 0 0 10px rgba(248, 113, 113, 0.3);
            }
            .dark-mode .breadcrumb {
                background: rgba(30, 41, 59, 0.6);
                border: 1px solid rgba(51, 65, 85, 0.3);
            }
            .dark-mode .breadcrumb-item:hover {
                background: rgba(51, 65, 85, 0.4);
            }
            .dark-mode .skeleton {
                background: linear-gradient(90deg, rgba(30, 41, 59, 0.5) 25%, rgba(51, 65, 85, 0.5) 50%, rgba(30, 41, 59, 0.5) 75%);
                background-size: 200% 100%;
                animation: skeleton-loading 1.5s infinite;
            }
            @keyframes skeleton-loading {
                0% { background-position: 200% 0; }
                100% { background-position: -200% 0; }
            }
            .dark-mode .pulse-animation {
                animation: pulse-glow 2s infinite;
            }
            @keyframes pulse-glow {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.7; box-shadow: 0 0 20px rgba(96, 165, 250, 0.4); }
            }
            /* ç™½å¤©æ¨¡å¼æ ·å¼ä¿®å¤ */
            body:not(.dark-mode) {
                background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
                color: #1f2937;
            }
            body:not(.dark-mode) .glass-card {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(226, 232, 240, 0.5);
            }
            body:not(.dark-mode) .glass-chart-container {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(226, 232, 240, 0.5);
            }
            /* é»‘å¤œæ¨¡å¼æ ·å¼ä¿®å¤ */
            body.dark-mode .glass-card {
                background: rgba(30, 41, 59, 0.7);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(51, 65, 85, 0.3);
                box-shadow: 0 8px 32px rgba(2, 8, 20, 0.4);
            }
            body.dark-mode .glass-chart-container {
                background: rgba(30, 41, 59, 0.7);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(51, 65, 85, 0.3);
                box-shadow: 0 8px 32px rgba(2, 8, 20, 0.4);
            }
            /* ç™½å¤©æ¨¡å¼è¡¨å•å…ƒç´ æ ·å¼ */
            body:not(.dark-mode) select,
            body:not(.dark-mode) input[type="text"],
            body:not(.dark-mode) input[type="number"] {
                background-color: #ffffff;
                color: #1f2937;
                border: 1px solid #d1d5db;
            }
            body:not(.dark-mode) select:focus,
            body:not(.dark-mode) input:focus {
                border-color: #3b82f6;
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            }
            body:not(.dark-mode) select option {
                background-color: #ffffff;
                color: #1f2937;
            }
            body:not(.dark-mode) .text-gray-600 {
                color: #4b5563;
            }
            body:not(.dark-mode) .text-gray-700 {
                color: #374151;
            }
            body:not(.dark-mode) .text-gray-400 {
                color: #9ca3af;
            }
            body:not(.dark-mode) .text-gray-500 {
                color: #6b7280;
            }
            /* Canvaså›¾è¡¨é˜´å½±æ•ˆæœ */
            .chart-container canvas {
                filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
                transition: filter 0.3s ease;
            }
            .dark-mode .chart-container canvas {
                filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
            }
            .chart-container canvas:hover {
                filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.15));
            }
            .dark-mode .chart-container canvas:hover {
                filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.4));
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-light to-white min-h-screen font-sans text-dark transition-colors duration-300">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="bg-white shadow-md sticky top-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <i class="fa fa-hdd-o text-2xl text-primary transition-colors duration-300"></i>
                <h1 class="text-[clamp(1.25rem,3vw,1.75rem)] font-bold text-dark transition-colors duration-300 text-shadow">æ‰«ç›˜å¤§ç‹</h1>
            </div>
            <div class="hidden md:flex items-center space-x-6">
                <a href="#" class="text-dark hover:text-primary transition-colors duration-300">ä¸»é¡µ</a>
            </div>
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-dark-surface-hover transition-all duration-300 group">
                <i class="fa fa-moon-o text-dark group-hover:text-primary transition-colors duration-300"></i>
            </button>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="container mx-auto px-4 py-8">
        <!-- æ‰«æè®¾ç½®åŒºåŸŸ -->
        <section class="mb-10 bg-white rounded-xl shadow-lg p-6 transform transition-all duration-300 hover:shadow-xl card-hover glass-card">
            <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                <h2 class="text-[clamp(1.1rem,2vw,1.5rem)] font-semibold text-dark mb-4 md:mb-0 text-shadow">æ‰«æè®¾ç½®</h2>
                <div class="flex items-center space-x-2">
                    <i class="fa fa-info-circle text-primary transition-colors duration-300"></i>
                    <span class="text-sm text-gray-600 dark:text-dark-text-secondary transition-colors duration-300">é€‰æ‹©ç›®æ ‡ç¡¬ç›˜è¿›è¡Œæ‰«æåˆ†æ</span>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- é©±åŠ¨å™¨é€‰æ‹© -->
                <div class="col-span-1">
                    <label for="drive-select" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-2 transition-colors duration-300">é€‰æ‹©é©±åŠ¨å™¨</label>
                    <div class="relative">
                        <select id="drive-select" class="block w-full pl-10 pr-12 py-3 bg-gray-50 dark:bg-dark-surface border border-gray-300 dark:border-dark-border rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-all duration-300 form-input">
                            <option value="">æ­£åœ¨åŠ è½½é©±åŠ¨å™¨...</option>
                        </select>
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                            <i class="fa fa-server text-gray-400 dark:text-dark-text-secondary transition-colors duration-300"></i>
                        </div>
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <i class="fa fa-chevron-down text-gray-400 dark:text-dark-text-secondary transition-colors duration-300"></i>
                        </div>
                    </div>
                </div>

                <!-- æ–‡ä»¶å¤¹è·¯å¾„è¾“å…¥ -->
                <div class="col-span-1">
                    <label for="folder-path" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-2 transition-colors duration-300">æˆ–æŒ‡å®šæ–‡ä»¶å¤¹</label>
                    <div class="relative">
                        <input type="text" id="folder-path" placeholder="å¦‚: C:\Users\Documents" class="block w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-dark-surface border border-gray-300 dark:border-dark-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-all duration-300 form-input">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                            <i class="fa fa-folder text-gray-400 dark:text-dark-text-secondary transition-colors duration-300"></i>
                        </div>
                    </div>
                </div>
                
                <!-- æ‰«ææ·±åº¦ -->
                <div class="col-span-1">
                    <label for="scan-depth" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-2 transition-colors duration-300">æ‰«ææ·±åº¦</label>
                    <div class="relative">
                        <input type="number" id="scan-depth" class="block w-full pl-10 pr-12 py-3 bg-gray-50 dark:bg-dark-surface border border-gray-300 dark:border-dark-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-all duration-300 form-input" min="1" max="50" value="10" placeholder="è¾“å…¥æ‰«ææ·±åº¦">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                            <i class="fa fa-search-plus text-gray-400 dark:text-dark-text-secondary transition-colors duration-300"></i>
                        </div>
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 text-xs text-gray-400 dark:text-dark-text-secondary transition-colors duration-300">
                            å±‚
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 dark:text-dark-text-secondary mt-1 transition-colors duration-300">æ•°å­—è¶Šå¤§æ‰«æè¶Šæ·±å…¥ï¼Œ1=ä»…å½“å‰æ–‡ä»¶å¤¹ï¼Œ10=æ·±å…¥10å±‚å­æ–‡ä»¶å¤¹</p>
                </div>
                
                <!-- æ‰«ææŒ‰é’®ç»„ -->
                <div class="col-span-1 flex items-end space-x-3">
                    <button id="scan-button" class="flex-1 bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center justify-center space-x-2 group btn-primary border-2 border-primary hover:border-primary/80">
                        <i class="fa fa-play-circle-o group-hover:scale-110 transition-transform duration-300"></i>
                        <span>å¼€å§‹æ‰«æ</span>
                    </button>
                    <button id="stop-button" class="bg-danger hover:bg-danger/90 text-white font-medium py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center justify-center space-x-2 group btn-danger hidden border-2 border-danger hover:border-danger/80">
                        <i class="fa fa-stop-circle-o group-hover:scale-110 transition-transform duration-300"></i>
                        <span>åœæ­¢æ‰«æ</span>
                    </button>
                </div>
            </div>
            
            <!-- æ‰«æè¿›åº¦ -->
            <div id="scan-progress-container" class="mt-6 hidden">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium text-gray-700 dark:text-dark-text-secondary transition-colors duration-300" id="scan-status-text">å‡†å¤‡æ‰«æ...</span>
                    <span class="text-sm font-medium text-primary dark:text-dark-primary transition-colors duration-300 text-glow" id="scan-percentage">0%</span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-dark-border rounded-full h-2.5 transition-colors duration-300">
                    <div id="scan-progress-bar" class="bg-primary dark:bg-dark-primary h-2.5 rounded-full transition-all duration-300 progress-glow" style="width: 0%"></div>
                </div>
                <div class="flex justify-between text-xs text-gray-500 dark:text-dark-text-secondary mt-2 transition-colors duration-300">
                    <span id="scanned-files-info">å·²æ‰«æ: 0 ä¸ªæ–‡ä»¶</span>
                    <span id="scanned-size-info">å·²æ‰«æ: 0 B</span>
                </div>
            </div>
        </section>
        
        <!-- é¥¼å›¾å±•ç¤ºåŒºåŸŸ -->
        <section id="charts-section" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-6 mb-10">
            <!-- ç¨‹åºå ç”¨ç©ºé—´é¥¼å›¾ -->
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover opacity-50 glass-chart-container" id="apps-chart-card">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-dark dark:text-dark-text flex items-center transition-colors duration-300">
                        <i class="fa fa-pie-chart text-primary dark:text-dark-primary mr-2 transition-colors duration-300"></i>
                        ç¨‹åºå ç”¨ç©ºé—´
                    </h3>
                    <div class="text-xs text-gray-500 dark:text-dark-text-secondary transition-colors duration-300" id="apps-total-size">0 B</div>
                </div>
                <div class="relative h-64 chart-container">
                    <canvas id="apps-chart"></canvas>
                </div>
                <div class="mt-4 max-h-40 overflow-y-auto" id="apps-legend-container">
                    <div class="text-center text-gray-500 dark:text-dark-text-secondary text-sm transition-colors duration-300" id="apps-placeholder">æ‰«æå®Œæˆåæ˜¾ç¤ºæ•°æ®</div>
                </div>
            </div>
            
            <!-- æ–‡ä»¶ç±»å‹åˆ†å¸ƒé¥¼å›¾ -->
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover opacity-50 glass-chart-container" id="types-chart-card">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-dark dark:text-dark-text flex items-center transition-colors duration-300">
                        <i class="fa fa-files-o text-secondary dark:text-dark-secondary mr-2 transition-colors duration-300"></i>
                        æ–‡ä»¶ç±»å‹åˆ†å¸ƒ
                    </h3>
                    <div class="text-xs text-gray-500 dark:text-dark-text-secondary transition-colors duration-300" id="types-total-count">0 ä¸ªæ–‡ä»¶</div>
                </div>
                <div class="relative h-64 chart-container">
                    <canvas id="types-chart"></canvas>
                </div>
                <div class="mt-4 max-h-40 overflow-y-auto" id="types-legend-container">
                    <div class="text-center text-gray-500 dark:text-dark-text-secondary text-sm transition-colors duration-300" id="types-placeholder">æ‰«æå®Œæˆåæ˜¾ç¤ºæ•°æ®</div>
                </div>
            </div>
            
            <!-- æ–‡ä»¶å¤¹å ç”¨ç©ºé—´é¥¼å›¾ -->
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover opacity-50 glass-chart-container" id="folders-chart-card">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-dark dark:text-dark-text flex items-center transition-colors duration-300">
                        <i class="fa fa-folder-open text-accent dark:text-dark-accent mr-2 transition-colors duration-300"></i>
                        æ–‡ä»¶å¤¹å ç”¨ç©ºé—´
                    </h3>
                    <div class="text-xs text-gray-500 dark:text-dark-text-secondary transition-colors duration-300" id="folders-total-size">0 B</div>
                </div>
                <div class="relative h-64 chart-container">
                    <canvas id="folders-chart"></canvas>
                </div>
                <div class="mt-4 max-h-40 overflow-y-auto" id="folders-legend-container">
                    <div class="text-center text-gray-500 dark:text-dark-text-secondary text-sm transition-colors duration-300" id="folders-placeholder">æ‰«æå®Œæˆåæ˜¾ç¤ºæ•°æ®</div>
                </div>
            </div>

            <!-- ä»£ç è¯­è¨€åˆ†ç±»é¥¼å›¾ -->
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover opacity-50 glass-chart-container" id="code-lang-chart-card">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-dark dark:text-dark-text flex items-center transition-colors duration-300">
                        <i class="fa fa-code text-purple-500 dark:text-purple-400 mr-2 transition-colors duration-300"></i>
                        ç¼–ç¨‹è¯­è¨€åˆ†å¸ƒ
                    </h3>
                    <div class="text-xs text-gray-500 dark:text-dark-text-secondary transition-colors duration-300" id="code-lang-total-size">0 B</div>
                </div>
                <div class="relative h-64 chart-container">
                    <canvas id="code-lang-chart"></canvas>
                </div>
                <div class="mt-4 max-h-40 overflow-y-auto" id="code-lang-legend-container">
                    <div class="text-center text-gray-500 dark:text-dark-text-secondary text-sm transition-colors duration-300" id="code-lang-placeholder">æ‰«æå®Œæˆåæ˜¾ç¤ºæ•°æ®</div>
                </div>
            </div>
        </section>
        
        <!-- è¯¦ç»†ä¿¡æ¯è¡¨æ ¼ -->
        <section id="details-section" class="bg-white rounded-xl shadow-lg p-6 mb-10 opacity-50">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
                <h2 class="text-[clamp(1.1rem,2vw,1.5rem)] font-semibold text-dark flex items-center">
                    <i class="fa fa-table text-primary mr-2"></i>
                    è¯¦ç»†æ•°æ®è§†å›¾
                </h2>
                
                <div class="flex flex-wrap gap-4 mt-4 md:mt-0">
                    <!-- æ•°æ®ç±»å‹é€‰æ‹© -->
                    <div class="relative">
                        <select id="data-view-select" class="pl-10 pr-12 py-2 border border-gray-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                            <option value="fileTypes">æ–‡ä»¶ç±»å‹</option>
                            <option value="folders">æ–‡ä»¶å¤¹</option>
                            <option value="applications">åº”ç”¨ç¨‹åº</option>
                        </select>
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                            <i class="fa fa-filter text-gray-400"></i>
                        </div>
                    </div>
                    
                    <!-- æœç´¢æ¡† -->
                    <div class="relative">
                        <input type="text" id="search-data" placeholder="æœç´¢..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
                        <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                    
                    <!-- æ’åºé€‰é¡¹ -->
                    <select id="sort-option" class="pl-4 pr-8 py-2 border border-gray-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary bg-white">
                        <option value="size-desc">æŒ‰å¤§å°æ’åºï¼ˆå¤§â†’å°ï¼‰</option>
                        <option value="size-asc">æŒ‰å¤§å°æ’åºï¼ˆå°â†’å¤§ï¼‰</option>
                        <option value="name-asc">æŒ‰åç§°æ’åºï¼ˆAâ†’Zï¼‰</option>
                        <option value="name-desc">æŒ‰åç§°æ’åºï¼ˆZâ†’Aï¼‰</option>
                    </select>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr id="table-header">
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åç§°</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å¤§å°</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å æ¯”</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ–‡ä»¶æ•°</th>
                        </tr>
                    </thead>
                    <tbody id="data-table-body" class="bg-white divide-y divide-gray-200">
                        <tr>
                            <td colspan="4" class="px-6 py-10 text-center text-gray-500">
                                <i class="fa fa-hdd-o text-4xl mb-3 block opacity-30"></i>
                                <p>æ‰«æå®Œæˆåæ˜¾ç¤ºæ•°æ®</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- åˆ†é¡µæ§åˆ¶ -->
            <div class="flex justify-between items-center mt-6" id="pagination-controls">
                <div class="text-sm text-gray-600">æ˜¾ç¤º <span id="start-item">0</span>-<span id="end-item">0</span> é¡¹ï¼Œå…± <span id="total-items">0</span> é¡¹</div>
                <div class="flex space-x-2">
                    <button id="prev-page" class="px-3 py-1 border border-gray-300 rounded-md text-sm bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fa fa-chevron-left"></i>
                    </button>
                    <button id="next-page" class="px-3 py-1 border border-gray-300 rounded-md text-sm bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fa fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- é¡µè„š -->
    <footer class="bg-dark text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center space-x-2">
                        <i class="fa fa-hdd-o text-primary"></i>
                        <span class="font-semibold">æ‰«ç›˜å¤§ç‹</span>
                    </div>
                    <p class="text-sm text-gray-400 mt-1">é«˜æ•ˆåˆ†æç¡¬ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ</p>
                </div>
                <div class="flex space-x-6">
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fa fa-question-circle-o"></i>
                        <span class="ml-1">å¸®åŠ©</span>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fa fa-github"></i>
                        <span class="ml-1">GitHub</span>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fa fa-envelope-o"></i>
                        <span class="ml-1">è”ç³»æˆ‘ä»¬</span>
                    </a>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-6 pt-6 text-center text-sm text-gray-500">
                &copy; 2025 æ‰«ç›˜å¤§ç‹ | æ‰€æœ‰æƒåˆ©ä¿ç•™
            </div>
        </div>
    </footer>

    <!-- è„šæœ¬éƒ¨åˆ† -->
    <script>
        // å…¨å±€å˜é‡
        let ws = null;
        let currentTaskId = null;
        let scanResults = null;
        let currentPage = 1;
        const itemsPerPage = 20;
        let appsChart = null;
        let typesChart = null;
        let foldersChart = null;
        let codeLangChart = null;
        let currentViewType = 'fileTypes';
        
        // DOM å…ƒç´ å¼•ç”¨
        const driveSelect = document.getElementById('drive-select');
        const scanButton = document.getElementById('scan-button');
        const stopButton = document.getElementById('stop-button');
        const scanProgressContainer = document.getElementById('scan-progress-container');
        const scanProgressBar = document.getElementById('scan-progress-bar');
        const scanStatusText = document.getElementById('scan-status-text');
        const scanPercentage = document.getElementById('scan-percentage');
        const scannedFilesInfo = document.getElementById('scanned-files-info');
        const scannedSizeInfo = document.getElementById('scanned-size-info');
        const dataViewSelect = document.getElementById('data-view-select');
        const searchData = document.getElementById('search-data');
        const sortOption = document.getElementById('sort-option');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const startItem = document.getElementById('start-item');
        const endItem = document.getElementById('end-item');
        const totalItems = document.getElementById('total-items');
        const themeToggle = document.getElementById('theme-toggle');
        const dataTableBody = document.getElementById('data-table-body');
        
        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            console.log('å¼€å§‹åˆå§‹åŒ–åº”ç”¨...');
            
            // åŠ è½½ä¿å­˜çš„ä¸»é¢˜åå¥½
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.body.classList.remove('bg-gradient-to-br', 'from-light', 'to-white');
                document.querySelector('header').classList.add('nav-glass');
                document.querySelectorAll('#apps-chart-card, #types-chart-card, #folders-chart-card').forEach(el => {
                    el.classList.add('glass-card');
                });
                document.querySelectorAll('#scan-button').forEach(el => {
                    el.classList.add('btn-primary');
                });
                document.querySelectorAll('#stop-button').forEach(el => {
                    el.classList.add('btn-danger');
                });
                document.querySelector('#scan-progress-bar').classList.add('progress-glow');
                document.querySelector('#scan-percentage').classList.add('text-glow');
                themeToggle.innerHTML = '<i class="fa fa-sun-o text-yellow-400 text-xl pulse-animation"></i>';
            }
            
            // è®¾ç½®é»˜è®¤æ‰«ææ·±åº¦ä¸º10
                const scanDepthInput = document.getElementById('scan-depth');
                if (scanDepthInput && (scanDepthInput.value === '' || scanDepthInput.value === '2')) {
                    scanDepthInput.value = '10';
                }
            
            // æ·»åŠ æ‰«æç»Ÿè®¡ä¿¡æ¯å…ƒç´ 
            if (!document.getElementById('scan-stats-info')) {
                const statsContainer = document.createElement('div');
                statsContainer.id = 'scan-stats-info';
                statsContainer.className = 'mt-4 p-4 bg-info/10 rounded-lg text-sm hidden';
                statsContainer.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 1000; background: rgba(240, 249, 255, 0.9); border: 1px solid #3b82f6;';
                document.body.appendChild(statsContainer);
            }
            
            // åŠ è½½ç³»ç»Ÿé©±åŠ¨å™¨
            loadDrives().catch(error => {
                console.error('åŠ è½½é©±åŠ¨å™¨å¤±è´¥:', error);
                // æ·»åŠ æ¨¡æ‹Ÿé©±åŠ¨å™¨ä»¥ä¾¿æµ‹è¯•
                driveSelect.innerHTML = '';
                const defaultOption = document.createElement('option');
                defaultOption.value = 'C:';
                defaultOption.textContent = 'C: æœ¬åœ°ç£ç›˜ (æ¨¡æ‹Ÿ)';
                driveSelect.appendChild(defaultOption);
                alert('æ— æ³•åŠ è½½çœŸå®é©±åŠ¨å™¨åˆ—è¡¨ï¼Œå·²æ·»åŠ æ¨¡æ‹ŸCç›˜ç”¨äºæµ‹è¯•');
            });
            
            // åˆå§‹åŒ–WebSocketè¿æ¥
            initWebSocket();
            
            // åˆå§‹åŒ–å›¾è¡¨
            try {
                initCharts();
                console.log('å›¾è¡¨åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('å›¾è¡¨åˆå§‹åŒ–å¤±è´¥:', error);
            }
            
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            scanButton.addEventListener('click', startScan);
            stopButton.addEventListener('click', stopScan);
            dataViewSelect.addEventListener('change', changeDataView);
            searchData.addEventListener('input', filterAndSortData);
            sortOption.addEventListener('change', filterAndSortData);
            prevPageBtn.addEventListener('click', goToPrevPage);
            nextPageBtn.addEventListener('click', goToNextPage);
            themeToggle.addEventListener('click', toggleTheme);
            
            // æ·»åŠ æ–‡ä»¶å¤¹è·¯å¾„è¾“å…¥æ¡†çš„æ™ºèƒ½äº¤äº’
            const folderPathInput = document.getElementById('folder-path');
            folderPathInput.addEventListener('input', function() {
                if (this.value.trim()) {
                    // å¦‚æœè¾“å…¥äº†æ–‡ä»¶å¤¹è·¯å¾„ï¼Œæ¸…ç©ºé©±åŠ¨å™¨é€‰æ‹©
                    driveSelect.value = '';
                }
            });
            
            // æ·»åŠ é©±åŠ¨å™¨é€‰æ‹©æ¡†çš„æ™ºèƒ½äº¤äº’
            driveSelect.addEventListener('change', function() {
                if (this.value) {
                    // å¦‚æœé€‰æ‹©äº†é©±åŠ¨å™¨ï¼Œæ¸…ç©ºæ–‡ä»¶å¤¹è·¯å¾„è¾“å…¥
                    folderPathInput.value = '';
                }
            });
            
            console.log('åˆå§‹åŒ–å®Œæˆ');
        }
        
        // åŠ è½½ç³»ç»Ÿé©±åŠ¨å™¨
        async function loadDrives() {
            try {
                const response = await fetch('/api/drives');
                if (!response.ok) {
                    throw new Error('è·å–é©±åŠ¨å™¨åˆ—è¡¨å¤±è´¥');
                }
                const drives = await response.json();
                
                // æ¸…ç©ºå¹¶å¡«å……é©±åŠ¨å™¨é€‰æ‹©æ¡†
                driveSelect.innerHTML = '';
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'è¯·é€‰æ‹©ä¸€ä¸ªé©±åŠ¨å™¨...';
                driveSelect.appendChild(defaultOption);
                
                drives.forEach(drive => {
                    const option = document.createElement('option');
                    option.value = drive.name;
                    option.textContent = `${drive.name} æœ¬åœ°ç£ç›˜`;
                    driveSelect.appendChild(option);
                });
                
                // æ·»åŠ è‡ªå®šä¹‰è·¯å¾„é€‰é¡¹
                const customOption = document.createElement('option');
                customOption.value = 'custom';
                customOption.textContent = 'ğŸ“ è‡ªå®šä¹‰æ–‡ä»¶å¤¹è·¯å¾„';
                driveSelect.appendChild(customOption);
            } catch (error) {
                console.error('åŠ è½½é©±åŠ¨å™¨å¤±è´¥:', error);
                driveSelect.innerHTML = '';
                const errorOption = document.createElement('option');
                errorOption.value = '';
                errorOption.textContent = 'æ— æ³•åŠ è½½é©±åŠ¨å™¨åˆ—è¡¨';
                driveSelect.appendChild(errorOption);
                alert('æ— æ³•åŠ è½½é©±åŠ¨å™¨åˆ—è¡¨: ' + error.message);
            }
        }
        
        // åˆå§‹åŒ–WebSocketè¿æ¥
        function initWebSocket() {
            const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${wsProtocol}//${window.location.host}`;
            
            console.log('æ­£åœ¨è¿æ¥WebSocket:', wsUrl);
            
            // é‡ç½®ä¹‹å‰çš„è¿æ¥
            if (ws) {
                ws.close();
            }
            
            ws = new WebSocket(wsUrl);
            ws.binaryType = 'blob';
            
            ws.onopen = () => {
                console.log('WebSocketè¿æ¥å·²å»ºç«‹');
                // æ˜¾ç¤ºè¿æ¥æˆåŠŸæç¤º
                const statusText = document.getElementById('scan-status-text');
                if (statusText && !scanProgressContainer.classList.contains('hidden')) {
                    statusText.textContent = 'WebSocketè¿æ¥å·²å»ºç«‹';
                }
            };
            
            ws.onmessage = (event) => {
                try {
                    console.log('æ¥æ”¶åˆ°WebSocketæ¶ˆæ¯:', event.data);
                    const data = JSON.parse(event.data);
                    handleWebSocketMessage(data);
                } catch (error) {
                    console.error('è§£æWebSocketæ¶ˆæ¯å¤±è´¥:', error);
                    console.error('åŸå§‹æ¶ˆæ¯:', event.data);
                }
            };
            
            ws.onclose = (event) => {
                console.log('WebSocketè¿æ¥å·²å…³é—­', event.code, event.reason);
                // æ˜¾ç¤ºè¿æ¥å…³é—­æç¤º
                const statusText = document.getElementById('scan-status-text');
                if (statusText && !scanProgressContainer.classList.contains('hidden')) {
                    statusText.textContent = 'WebSocketè¿æ¥å·²æ–­å¼€';
                }
                // å°è¯•é‡æ–°è¿æ¥
                setTimeout(() => {
                    console.log('å°è¯•é‡æ–°è¿æ¥WebSocket...');
                    initWebSocket();
                }, 5000);
            };
            
            ws.onerror = (error) => {
                console.error('WebSocketé”™è¯¯:', error);
                // æ˜¾ç¤ºé”™è¯¯æç¤º
                const statusText = document.getElementById('scan-status-text');
                if (statusText && !scanProgressContainer.classList.contains('hidden')) {
                    statusText.textContent = 'WebSocketè¿æ¥é”™è¯¯';
                }
            };
        }
        
        // å¤„ç†WebSocketæ¶ˆæ¯
        function handleWebSocketMessage(data) {
            console.log('å¤„ç†WebSocketæ¶ˆæ¯:', JSON.stringify(data));
            
            // å¤„ç†å¯èƒ½çš„å­—ç¬¦ä¸²æ¶ˆæ¯
            if (typeof data === 'string') {
                try {
                    data = JSON.parse(data);
                } catch (e) {
                    console.error('æ— æ³•è§£ææ¶ˆæ¯:', data);
                    return;
                }
            }
            
            // éªŒè¯æ¶ˆæ¯æ ¼å¼
            if (!data || typeof data.type !== 'string') {
                console.error('æ— æ•ˆçš„æ¶ˆæ¯æ ¼å¼:', data);
                return;
            }
            
            switch (data.type) {
                case 'scan_started':
                    console.log('æ‰«æå¼€å§‹:', data.payload);
                    if (data.payload && data.payload.taskId) {
                        currentTaskId = data.payload.taskId;
                        updateUIForScanStart();
                    } else {
                        console.error('æ— æ•ˆçš„æ‰«æå¼€å§‹æ¶ˆæ¯ï¼Œç¼ºå°‘taskId');
                        currentTaskId = 'default-task'; // è®¾ç½®é»˜è®¤ä»»åŠ¡ID
                        updateUIForScanStart();
                    }
                    break;
                case 'scan_progress':
                    console.log('æ‰«æè¿›åº¦:', data.payload);
                    if (data.payload) {
                        updateScanProgress(data.payload);
                    } else {
                        console.error('æ— æ•ˆçš„æ‰«æè¿›åº¦æ¶ˆæ¯');
                    }
                    break;
                case 'scan_complete':
                    console.log('æ‰«æå®Œæˆï¼ŒåŸå§‹ç»“æœ:', JSON.stringify(data.payload));
                    if (data.payload) {
                        // å…¼å®¹å¯èƒ½çš„ç›´æ¥è¿”å›æ ¼å¼
                        scanResults = data.payload.stats || data.payload;
                        console.log('å¤„ç†åçš„æ‰«æç»“æœ:', scanResults);
                        updateUIForScanComplete();
                    } else {
                        console.error('æ— æ•ˆçš„æ‰«æå®Œæˆæ¶ˆæ¯');
                        // æ˜¾ç¤ºé”™è¯¯å¹¶é‡ç½®UI
                        updateUIForScanError('æ‰«æå®Œæˆä½†æœªè¿”å›æ•°æ®');
                    }
                    break;
                case 'scan_stopped':
                    updateUIForScanStopped();
                    break;
                case 'scan_error':
                    const errorMessage = data.payload && data.payload.error ? data.payload.error : 'æœªçŸ¥é”™è¯¯';
                    updateUIForScanError(errorMessage);
                    break;
                default:
                    console.log('æœªçŸ¥æ¶ˆæ¯ç±»å‹:', data.type);
            }
        }
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            const appsCtx = document.getElementById('apps-chart').getContext('2d');
            const typesCtx = document.getElementById('types-chart').getContext('2d');
            const foldersCtx = document.getElementById('folders-chart').getContext('2d');
            const codeLangCtx = document.getElementById('code-lang-chart').getContext('2d');
            
            // å›¾è¡¨é€šç”¨é…ç½®
            const chartConfig = {
                type: 'doughnut',
                data: {
                    labels: ['å‡†å¤‡æ‰«æ'],
                    datasets: [{
                        data: [1],
                        backgroundColor: ['#3b82f6'],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            bodyFont: {
                                size: 12
                            },
                            callbacks: {
                                label: function(context) {
                                    return 'è¯·é€‰æ‹©é©±åŠ¨å™¨å¹¶å¼€å§‹æ‰«æ';
                                }
                            }
                        }
                    }
                }
            };
            
            try {
                // åˆ›å»ºå›¾è¡¨å®ä¾‹
                appsChart = new Chart(appsCtx, { ...chartConfig });
                typesChart = new Chart(typesCtx, { ...chartConfig });
                foldersChart = new Chart(foldersCtx, { ...chartConfig });
                codeLangChart = new Chart(codeLangCtx, { ...chartConfig });
                console.log('å›¾è¡¨åˆå§‹åŒ–æˆåŠŸ');
            } catch (error) {
                console.error('å›¾è¡¨åˆå§‹åŒ–å¤±è´¥:', error);
            }
        }
        
        // å¼€å§‹æ‰«æ
        function startScan() {
            const drive = driveSelect.value;
            const folderPath = document.getElementById('folder-path').value;
            let scanDepth = parseInt(document.getElementById('scan-depth').value);
            
            // éªŒè¯è¾“å…¥ï¼šå¿…é¡»é€‰æ‹©é©±åŠ¨å™¨æˆ–è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„
            if (!drive && !folderPath) {
                alert('è¯·é€‰æ‹©ä¸€ä¸ªé©±åŠ¨å™¨æˆ–è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„');
                return;
            }
            
            // å¦‚æœè¾“å…¥äº†æ–‡ä»¶å¤¹è·¯å¾„ï¼Œä¼˜å…ˆä½¿ç”¨æ–‡ä»¶å¤¹è·¯å¾„
            if (folderPath) {
                // éªŒè¯æ–‡ä»¶å¤¹è·¯å¾„æ ¼å¼
                if (!folderPath.match(/^[a-zA-Z]:[\\\/].*/)) {
                    alert('æ–‡ä»¶å¤¹è·¯å¾„æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¾“å…¥å¦‚: C:\\Users\\Documents');
                    return;
                }
            }
            
            // è®¾ç½®æ›´åˆç†çš„é»˜è®¤æ‰«ææ·±åº¦
                if (isNaN(scanDepth) || scanDepth < 1) {
                    scanDepth = 10;
                    document.getElementById('scan-depth').value = scanDepth;
                    console.log('ä½¿ç”¨é»˜è®¤æ‰«ææ·±åº¦:', scanDepth);
                }
            
            // æ£€æŸ¥WebSocketè¿æ¥çŠ¶æ€
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                console.error('WebSocketè¿æ¥æœªå»ºç«‹:', ws ? ws.readyState : 'æœªåˆå§‹åŒ–');
                // å°è¯•é‡æ–°è¿æ¥
                initWebSocket();
                setTimeout(() => {
                    if (ws && ws.readyState === WebSocket.OPEN) {
                        console.log('è¿æ¥å»ºç«‹åé‡è¯•æ‰«æ');
                        doStartScan(drive, scanDepth);
                    } else {
                        alert('WebSocketè¿æ¥å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                    }
                }, 2000);
                return;
            }
            
            doStartScan(drive, scanDepth);
        }
        
        function doStartScan(drive, scanDepth) {
            const folderPath = document.getElementById('folder-path').value;
            console.log('å¼€å§‹æ‰«æ - é©±åŠ¨å™¨:', drive, 'æ–‡ä»¶å¤¹è·¯å¾„:', folderPath, 'æ·±åº¦:', scanDepth);
            
            // æ¸…ç©ºä¹‹å‰çš„æ‰«æç»“æœ
            scanResults = null;
            
            // æ ¹æ®ç”¨æˆ·é€‰æ‹©ç¡®å®šæ‰«æè·¯å¾„
            let scanPath;
            if (folderPath) {
                // ä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„æ–‡ä»¶å¤¹è·¯å¾„
                scanPath = folderPath;
            } else if (drive === 'custom') {
                // è‡ªå®šä¹‰è·¯å¾„æ¨¡å¼ - ä½¿ç”¨æ–‡ä»¶å¤¹é€‰æ‹©å™¨ï¼ˆå‘åå…¼å®¹ï¼‰
                const customPath = prompt('è¯·è¾“å…¥è¦æ‰«æçš„æ–‡ä»¶å¤¹è·¯å¾„:');
                if (!customPath) {
                    alert('æœªè¾“å…¥è·¯å¾„ï¼Œå–æ¶ˆæ‰«æ');
                    return;
                }
                scanPath = customPath;
            } else {
                // é©±åŠ¨å™¨æ¨¡å¼ - ç¡®ä¿æ˜¯å®Œæ•´è·¯å¾„æ ¼å¼
                if (drive.length === 2 && drive.endsWith(':')) {
                    // å¦‚æœæ˜¯C:è¿™æ ·çš„æ ¼å¼ï¼Œè½¬æ¢ä¸ºC:\
                    scanPath = drive + '\\';
                } else {
                    scanPath = drive;
                }
            }
            
            console.log('æ‰«æè·¯å¾„:', scanPath);
            
            // å‘é€æ‰«æè¯·æ±‚
            const scanRequest = {
                type: 'start_scan',
                payload: {
                    drivePath: scanPath,
                    scanDepth
                }
            };
            
            console.log('å‘é€æ‰«æè¯·æ±‚:', scanRequest);
            try {
                ws.send(JSON.stringify(scanRequest));
            } catch (error) {
                console.error('å‘é€æ‰«æè¯·æ±‚å¤±è´¥:', error);
                alert('å‘é€æ‰«æè¯·æ±‚å¤±è´¥: ' + error.message);
            }
        }
        
        // åœæ­¢æ‰«æ
        function stopScan() {
            if (!currentTaskId || ws.readyState !== WebSocket.OPEN) {
                return;
            }
            
            ws.send(JSON.stringify({
                type: 'stop_scan',
                payload: {
                    taskId: currentTaskId
                }
            }));
        }
        
        // æ›´æ–°æ‰«æå¼€å§‹æ—¶çš„UI
        function updateUIForScanStart() {
            // é‡ç½®è¿›åº¦æ¡
            scanProgressBar.style.width = '0%';
            scanStatusText.textContent = 'å¼€å§‹æ‰«æ...';
            scanPercentage.textContent = '0%';
            scannedFilesInfo.textContent = 'å·²æ‰«æ: 0 ä¸ªæ–‡ä»¶';
            scannedSizeInfo.textContent = 'å·²æ‰«æ: 0 B';
            
            // æ˜¾ç¤ºè¿›åº¦æ¡ï¼Œéšè—å›¾è¡¨
            scanProgressContainer.classList.remove('hidden');
            
            // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
            scanButton.classList.add('hidden');
            stopButton.classList.remove('hidden');
            
            // ç¦ç”¨é©±åŠ¨å™¨é€‰æ‹©
            driveSelect.disabled = true;
            
            // ç¦ç”¨å›¾è¡¨å’Œè¯¦æƒ…åŒºåŸŸ
            const cards = document.querySelectorAll('#apps-chart-card, #types-chart-card, #folders-chart-card, #code-lang-chart-card, #details-section');
            cards.forEach(card => {
                card.classList.add('opacity-50');
            });
        }
        
        // æ›´æ–°æ‰«æè¿›åº¦
        function updateScanProgress(progress) {
            const { scannedCount, totalSize, errorCount } = progress;
            
            // ä¼°ç®—è¿›åº¦ç™¾åˆ†æ¯”ï¼ˆç”±äºä¸çŸ¥é“æ€»æ–‡ä»¶æ•°ï¼Œè¿™é‡Œåªæ˜¯ä¸€ä¸ªå‚è€ƒå€¼ï¼‰
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåç«¯å¯ä»¥æä¾›æ›´å‡†ç¡®çš„è¿›åº¦ä¿¡æ¯
            const estimatedPercent = Math.min(95, Math.floor(scannedCount / 100));
            
            scanProgressBar.style.width = estimatedPercent + '%';
            scanPercentage.textContent = estimatedPercent + '%';
            scannedFilesInfo.textContent = `å·²æ‰«æ: ${scannedCount.toLocaleString()} ä¸ªæ–‡ä»¶`;
            scannedSizeInfo.textContent = `å·²æ‰«æ: ${formatBytes(totalSize)}`;
            
            if (errorCount > 0) {
                scanStatusText.textContent = `æ‰«æä¸­... (${errorCount} ä¸ªæ–‡ä»¶è®¿é—®å¤±è´¥)`;
            } else {
                scanStatusText.textContent = 'æ‰«æä¸­...';
            }
        }
        
        // æ›´æ–°æ‰«æå®Œæˆæ—¶çš„UI
        function updateUIForScanComplete() {
            console.log('æ‰«æå®Œæˆï¼Œå¤„ç†ç»“æœ:', JSON.stringify(scanResults));
            
            // æ›´æ–°UIçŠ¶æ€
            scanProgressBar.style.width = '100%';
            scanPercentage.textContent = '100%';
            scanStatusText.textContent = 'æ‰«æå®Œæˆ';
            
            // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
            scanButton.classList.remove('hidden');
            stopButton.classList.add('hidden');
            
            // å¯ç”¨é©±åŠ¨å™¨é€‰æ‹©
            driveSelect.disabled = false;
            
            // éªŒè¯æ‰«æç»“æœæ•°æ®
            if (!scanResults) {
                console.error('æ‰«æç»“æœä¸ºç©º');
                alert('æ‰«æç»“æœä¸ºç©ºï¼Œè¯·å°è¯•é‡æ–°æ‰«æ');
                return;
            }
            
            // æ ‡å‡†åŒ–æ‰«æç»“æœæ ¼å¼
            normalizeScanResults();
            
            console.log('æ ‡å‡†åŒ–åæ‰«æç»“æœ:', {
                fileTypesCount: scanResults.fileTypes.length,
                foldersCount: scanResults.folders.length,
                applicationsCount: scanResults.applications.length,
                totalFiles: scanResults.totalFiles,
                totalSize: scanResults.totalSize
            });
            
            // æ›´æ–°å›¾è¡¨å’Œæ•°æ®è¡¨æ ¼
            updateCharts();
            updateDataTable();
            
            // æ˜¾ç¤ºè¯¦ç»†çš„æ‰«æç»Ÿè®¡ä¿¡æ¯
            showScanStatistics();
            
            // å¯ç”¨å›¾è¡¨å’Œè¯¦æƒ…åŒºåŸŸ
            const cards = document.querySelectorAll('#apps-chart-card, #types-chart-card, #folders-chart-card, #code-lang-chart-card, #details-section');
            cards.forEach(card => {
                card.classList.remove('opacity-50');
            });
            
            // æ˜¾ç¤ºæ‰«æç»Ÿè®¡ä¿¡æ¯
            alert(`æ‰«æå®Œæˆï¼\nå‘ç°æ–‡ä»¶æ•°: ${scanResults.totalFiles || 0}\næ€»å¤§å°: ${formatBytes(scanResults.totalSize || 0)}\né”™è¯¯æ•°: ${scanResults.errorCount || 0}`);
            
            // é‡ç½®å½“å‰ä»»åŠ¡ID
            currentTaskId = null;
        }
        
        // æ›´æ–°æ‰«æåœæ­¢æ—¶çš„UI
        function updateUIForScanStopped() {
            scanStatusText.textContent = 'æ‰«æå·²åœæ­¢';
            
            // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
            scanButton.classList.remove('hidden');
            stopButton.classList.add('hidden');
            
            // å¯ç”¨é©±åŠ¨å™¨é€‰æ‹©
            driveSelect.disabled = false;
            
            // é‡ç½®å½“å‰ä»»åŠ¡ID
            currentTaskId = null;
        }
        
        // æ›´æ–°æ‰«æé”™è¯¯æ—¶çš„UI
        function updateUIForScanError(error) {
            scanStatusText.textContent = `æ‰«æå‡ºé”™: ${error}`;
            
            // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
            scanButton.classList.remove('hidden');
            stopButton.classList.add('hidden');
            
            // å¯ç”¨é©±åŠ¨å™¨é€‰æ‹©
            driveSelect.disabled = false;
            
            // é‡ç½®å½“å‰ä»»åŠ¡ID
            currentTaskId = null;
            
            alert('æ‰«æè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + error);
        }
        
        // æ ‡å‡†åŒ–æ‰«æç»“æœæ ¼å¼
        function normalizeScanResults() {
            // ç¡®ä¿å¿…è¦çš„æ•°ç»„å­˜åœ¨
            if (!scanResults.fileTypes || !Array.isArray(scanResults.fileTypes)) {
                scanResults.fileTypes = [];
            }
            if (!scanResults.folders || !Array.isArray(scanResults.folders)) {
                scanResults.folders = [];
            }
            if (!scanResults.applications || !Array.isArray(scanResults.applications)) {
                scanResults.applications = [];
            }
            
            // ç¡®ä¿ç»Ÿè®¡æ•°æ®å­˜åœ¨
            if (typeof scanResults.totalFiles !== 'number') {
                scanResults.totalFiles = 0;
            }
            if (typeof scanResults.totalSize !== 'number') {
                scanResults.totalSize = 0;
            }
            if (typeof scanResults.errorCount !== 'number') {
                scanResults.errorCount = 0;
            }
            
            // è½¬æ¢å¯¹è±¡æ ¼å¼çš„æ•°æ®ä¸ºæ•°ç»„æ ¼å¼
            if (scanResults.fileTypes && typeof scanResults.fileTypes === 'object' && !Array.isArray(scanResults.fileTypes)) {
                scanResults.fileTypes = Object.entries(scanResults.fileTypes)
                    .map(([key, value]) => ({
                        name: key,
                        size: value.size || value,
                        count: value.count || 0
                    }))
                    .filter(item => item.size > 0)
                    .sort((a, b) => b.size - a.size);
            }
            
            // ç¡®ä¿æ¯ä¸ªé¡¹ç›®éƒ½æœ‰å¿…è¦çš„å±æ€§ - ä¿®å¤æ–‡ä»¶ç±»å‹æ˜¾ç¤º
            scanResults.fileTypes = scanResults.fileTypes.map(item => {
                console.log('å¤„ç†æ–‡ä»¶ç±»å‹é¡¹:', item);
                return {
                    name: item.name || item.type || 'æœªçŸ¥ç±»å‹',  // ä¼˜å…ˆä½¿ç”¨nameå­—æ®µ
                    size: item.size || 0,
                    count: item.count || 0,
                    extension: item.extension || item.type || '',
                    description: item.description || ''
                };
            });
            
            scanResults.folders = scanResults.folders.map(item => ({
                name: item.name || 'æœªçŸ¥æ–‡ä»¶å¤¹',
                size: item.size || 0
            }));
            
            scanResults.applications = scanResults.applications.map(item => ({
                name: item.name || 'æœªçŸ¥åº”ç”¨',
                size: item.size || 0
            }));
            
            // æŒ‰å¤§å°æ’åº
            scanResults.fileTypes.sort((a, b) => b.size - a.size);
            scanResults.folders.sort((a, b) => b.size - a.size);
            scanResults.applications.sort((a, b) => b.size - a.size);
            
            // è¿‡æ»¤æ‰å¤§å°ä¸º0çš„é¡¹
            scanResults.fileTypes = scanResults.fileTypes.filter(item => item.size > 0);
            scanResults.folders = scanResults.folders.filter(item => item.size > 0);
            scanResults.applications = scanResults.applications.filter(item => item.size > 0);
            
            // ç”Ÿæˆç¼–ç¨‹è¯­è¨€åˆ†å¸ƒæ•°æ®
            generateCodeLanguageData();
        }
        
        // ç”Ÿæˆç¼–ç¨‹è¯­è¨€åˆ†å¸ƒæ•°æ®
        function generateCodeLanguageData() {
            const codeLanguages = {
                'JavaScript': { extensions: ['.js', '.jsx', '.mjs'], size: 0, count: 0 },
                'TypeScript': { extensions: ['.ts', '.tsx'], size: 0, count: 0 },
                'HTML': { extensions: ['.html', '.htm', '.xhtml'], size: 0, count: 0 },
                'CSS': { extensions: ['.css', '.scss', '.sass', '.less'], size: 0, count: 0 },
                'Python': { extensions: ['.py', '.pyw', '.pyx'], size: 0, count: 0 },
                'Java': { extensions: ['.java'], size: 0, count: 0 },
                'C/C++': { extensions: ['.c', '.cpp', '.cc', '.cxx', '.h', '.hpp'], size: 0, count: 0 },
                'C#': { extensions: ['.cs'], size: 0, count: 0 },
                'PHP': { extensions: ['.php', '.php3', '.php4', '.php5'], size: 0, count: 0 },
                'Ruby': { extensions: ['.rb'], size: 0, count: 0 },
                'Go': { extensions: ['.go'], size: 0, count: 0 },
                'Rust': { extensions: ['.rs'], size: 0, count: 0 },
                'Swift': { extensions: ['.swift'], size: 0, count: 0 },
                'Kotlin': { extensions: ['.kt', '.kts'], size: 0, count: 0 },
                'SQL': { extensions: ['.sql'], size: 0, count: 0 },
                'Shell': { extensions: ['.sh', '.bash', '.zsh'], size: 0, count: 0 },
                'XML': { extensions: ['.xml', '.xsl', '.xslt'], size: 0, count: 0 },
                'JSON': { extensions: ['.json'], size: 0, count: 0 },
                'Markdown': { extensions: ['.md', '.markdown'], size: 0, count: 0 },
                'å…¶ä»–': { extensions: [], size: 0, count: 0 }
            };
            
            // ç»Ÿè®¡ä»£ç æ–‡ä»¶
            scanResults.fileTypes.forEach(fileType => {
                const extension = fileType.extension || fileType.name || '';
                let found = false;
                
                // æ£€æŸ¥æ˜¯å¦åŒ¹é…å·²çŸ¥ç¼–ç¨‹è¯­è¨€
                for (const [language, config] of Object.entries(codeLanguages)) {
                    if (language !== 'å…¶ä»–' && config.extensions.includes(extension.toLowerCase())) {
                        config.size += fileType.size;
                        config.count += fileType.count;
                        found = true;
                        break;
                    }
                }
                
                // æœªåŒ¹é…çš„æ–‡ä»¶å½’ç±»åˆ°"å…¶ä»–"
                if (!found && extension) {
                    codeLanguages['å…¶ä»–'].size += fileType.size;
                    codeLanguages['å…¶ä»–'].count += fileType.count;
                }
            });
            
            // è½¬æ¢ä¸ºæ•°ç»„æ ¼å¼å¹¶æŒ‰å¤§å°æ’åº
            scanResults.codeLanguages = Object.entries(codeLanguages)
                .filter(([_, data]) => data.size > 0)
                .map(([name, data]) => ({
                    name: name,
                    size: data.size,
                    count: data.count
                }))
                .sort((a, b) => b.size - a.size);
        }
        
        // æ˜¾ç¤ºæ‰«æç»Ÿè®¡ä¿¡æ¯
        function showScanStatistics() {
            const stats = [
                `æ–‡ä»¶æ€»æ•°: ${scanResults.totalFiles.toLocaleString()}`,
                `æ€»å¤§å°: ${formatBytes(scanResults.totalSize)}`,
                `é”™è¯¯æ•°: ${scanResults.errorCount}`,
                `æ–‡ä»¶ç±»å‹: ${scanResults.fileTypes.length} ç§`,
                `æ–‡ä»¶å¤¹: ${scanResults.folders.length} ä¸ª`,
                `åº”ç”¨ç¨‹åº: ${scanResults.applications.length} ä¸ª`
            ];
            
            console.log('æ‰«æç»Ÿè®¡:', stats.join('; '));
            
            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼Œé¿å…é¢‘ç¹å¼¹çª—
            const statsElement = document.getElementById('scan-stats-info');
            if (statsElement) {
                statsElement.innerHTML = stats.join('<br>');
                statsElement.classList.remove('hidden');
            } else {
                // å¦‚æœæ²¡æœ‰ç»Ÿè®¡å…ƒç´ ï¼Œä½¿ç”¨alert
                alert('æ‰«æå®Œæˆï¼\n' + stats.join('\n'));
            }
        }
        
        // æ›´æ–°å›¾è¡¨
        function updateCharts() {
            if (!scanResults) return;
            
            console.log('æ›´æ–°å›¾è¡¨æ•°æ®');
            
            // 1. ç¨‹åºå ç”¨ç©ºé—´é¥¼å›¾æ•°æ®
            const applicationsData = scanResults.applications || [];
            console.log('åº”ç”¨ç¨‹åºæ•°æ®æ•°é‡:', applicationsData.length);
            updateChart(appsChart, applicationsData, 'apps', scanResults.totalSize || 0);
            document.getElementById('apps-total-size').textContent = formatBytes(scanResults.totalSize || 0);
            
            // 2. æ–‡ä»¶ç±»å‹åˆ†å¸ƒé¥¼å›¾æ•°æ®
            const fileTypesData = scanResults.fileTypes || [];
            console.log('æ–‡ä»¶ç±»å‹æ•°æ®æ•°é‡:', fileTypesData.length);
            updateChart(typesChart, fileTypesData, 'types', scanResults.totalSize || 0);
            document.getElementById('types-total-count').textContent = (scanResults.totalFiles || 0).toLocaleString() + ' ä¸ªæ–‡ä»¶';
            
            // 3. æ–‡ä»¶å¤¹å ç”¨ç©ºé—´é¥¼å›¾æ•°æ®
            const foldersData = scanResults.folders || [];
            console.log('æ–‡ä»¶å¤¹æ•°æ®æ•°é‡:', foldersData.length);
            updateChart(foldersChart, foldersData, 'folders', scanResults.totalSize || 0);
            document.getElementById('folders-total-size').textContent = formatBytes(scanResults.totalSize || 0);
            
            // 4. ç¼–ç¨‹è¯­è¨€åˆ†å¸ƒé¥¼å›¾æ•°æ®
            const codeLangData = scanResults.codeLanguages || [];
            console.log('ç¼–ç¨‹è¯­è¨€æ•°æ®æ•°é‡:', codeLangData.length);
            updateChart(codeLangChart, codeLangData, 'code-lang', scanResults.totalSize || 0);
            const codeLangTotalSize = codeLangData.reduce((sum, item) => sum + item.size, 0);
            document.getElementById('code-lang-total-size').textContent = formatBytes(codeLangTotalSize);
            
            // æ›´æ–°å›¾ä¾‹
            updateLegend('apps-legend-container', applicationsData, 'size', scanResults.totalSize || 0);
            updateLegend('types-legend-container', fileTypesData, 'size', scanResults.totalSize || 0);
            updateLegend('folders-legend-container', foldersData, 'size', scanResults.totalSize || 0);
            updateLegend('code-lang-legend-container', codeLangData, 'size', codeLangTotalSize);
        }
        
        // æ›´æ–°å•ä¸ªå›¾è¡¨
        function updateChart(chart, data, type, totalSize) {
            // å¤„ç†ç©ºæ•°æ®æƒ…å†µ
            if (!data || data.length === 0) {
                chart.data.labels = ['æš‚æ— æ•°æ®'];
                chart.data.datasets[0].data = [1];
                chart.data.datasets[0].backgroundColor = ['#e5e7eb'];
                chart.update();
                return;
            }
            
            // ç”Ÿæˆé¢œè‰²
            const colors = generateColors(Math.min(data.length, 10)); // é™åˆ¶é¢œè‰²æ•°é‡
            
            // å¤„ç†å¤§é‡æ•°æ®çš„æƒ…å†µï¼Œåªæ˜¾ç¤ºå‰Nä¸ªï¼Œå…¶ä½™åˆå¹¶ä¸º"å…¶ä»–"
            const maxItems = 8;
            let itemsToDisplay = data;
            let otherValue = 0;
            
            if (data.length > maxItems) {
                itemsToDisplay = data.slice(0, maxItems);
                otherValue = data.slice(maxItems).reduce((sum, item) => sum + item.size, 0);
            }
            
            // å‡†å¤‡å›¾è¡¨æ•°æ®
            const labels = itemsToDisplay.map(item => item.name);
            const values = itemsToDisplay.map(item => item.size);
            
            // å¦‚æœæœ‰"å…¶ä»–"ç±»åˆ«ï¼Œæ·»åŠ åˆ°æ•°æ®ä¸­
            if (otherValue > 0) {
                labels.push('å…¶ä»–');
                values.push(otherValue);
            }
            
            // æ›´æ–°å›¾è¡¨æ•°æ®
            chart.data.labels = labels;
            chart.data.datasets[0].data = values;
            chart.data.datasets[0].backgroundColor = generateColors(labels.length);
            
            // æ›´æ–°tooltipæ ¹æ®å›¾è¡¨ç±»å‹æ˜¾ç¤ºä¸åŒæ ¼å¼
            chart.options.plugins.tooltip.callbacks.label = function(context) {
                let label = context.label || '';
                let value = context.raw || 0;
                let percentage = totalSize > 0 ? Math.round((value / totalSize) * 100) : 0;
                
                if (label) {
                    label += ': ';
                }
                
                return label + formatBytes(value) + ' (' + percentage + '%)';
            };
            
            chart.update();
        }
        
        // ç”Ÿæˆé¢œè‰²æ•°ç»„
        function generateColors(count) {
            const baseColors = [
                '#3b82f6', '#10b981', '#f59e0b', '#ef4444',
                '#8b5cf6', '#ec4899', '#14b8a6', '#f97316',
                '#84cc16', '#6366f1'
            ];
            
            const colors = [];
            for (let i = 0; i < count; i++) {
                colors.push(baseColors[i % baseColors.length]);
            }
            return colors;
        }
        
        // æ›´æ–°å›¾ä¾‹
        function updateLegend(containerId, items, valueType, totalValue) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (!items || items.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 text-sm">æ— æ•°æ®</div>';
                return;
            }
            
            const colors = generateColors(Math.min(items.length, 10));
            
            // é™åˆ¶æ˜¾ç¤ºçš„é¡¹æ•°
            const maxItems = 10;
            const itemsToDisplay = items.slice(0, maxItems);
            
            itemsToDisplay.forEach((item, index) => {
                const legendItem = document.createElement('div');
                legendItem.className = 'flex items-center justify-between py-1 text-sm';
                
                const labelContainer = document.createElement('div');
                labelContainer.className = 'flex items-center';
                
                const colorDot = document.createElement('span');
                colorDot.className = 'w-3 h-3 rounded-full mr-2';
                colorDot.style.backgroundColor = colors[index];
                
                const label = document.createElement('span');
                label.textContent = item.name;
                label.title = item.name; // æ·»åŠ æ‚¬åœæç¤º
                
                const valueContainer = document.createElement('div');
                valueContainer.className = 'text-right';
                
                const value = document.createElement('span');
                value.className = 'font-medium';
                value.textContent = formatBytes(item.size);
                
                const percentage = document.createElement('span');
                percentage.className = 'text-xs text-gray-500 block';
                percentage.textContent = totalValue > 0 ? 
                    `(${Math.round((item.size / totalValue) * 100)}%)` : 
                    '(0%)';
                
                valueContainer.appendChild(value);
                valueContainer.appendChild(percentage);
                labelContainer.appendChild(colorDot);
                labelContainer.appendChild(label);
                legendItem.appendChild(labelContainer);
                legendItem.appendChild(valueContainer);
                
                container.appendChild(legendItem);
            });
            
            // å¦‚æœæœ‰æ›´å¤šé¡¹ï¼Œæ·»åŠ "æ˜¾ç¤ºæ›´å¤š"æç¤º
            if (items.length > maxItems) {
                const moreItem = document.createElement('div');
                moreItem.className = 'text-center text-xs text-gray-500 mt-2 italic';
                moreItem.textContent = `è¿˜æœ‰ ${items.length - maxItems} é¡¹æœªæ˜¾ç¤º`;
                container.appendChild(moreItem);
            }
        }
        
        // æ›´æ”¹æ•°æ®è§†å›¾ç±»å‹
        function changeDataView() {
            currentViewType = dataViewSelect.value;
            currentPage = 1; // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
            filterAndSortData();
        }
        
        // è¿‡æ»¤å’Œæ’åºæ•°æ®
        function filterAndSortData() {
            if (!scanResults) return;
            
            const query = searchData.value.toLowerCase();
            const sortBy = sortOption.value;
            
            // è·å–å½“å‰è§†å›¾ç±»å‹çš„æ•°æ®
            let data = [];
            switch (currentViewType) {
                case 'fileTypes':
                    data = [...scanResults.fileTypes];
                    break;
                case 'folders':
                    data = [...scanResults.folders];
                    break;
                case 'applications':
                    data = [...scanResults.applications];
                    break;
            }
            
            // åº”ç”¨è¿‡æ»¤
            const filteredData = data.filter(item => 
                item.name.toLowerCase().includes(query)
            );
            
            // åº”ç”¨æ’åº
            let sortedData;
            switch (sortBy) {
                case 'size-desc':
                    sortedData = [...filteredData].sort((a, b) => b.size - a.size);
                    break;
                case 'size-asc':
                    sortedData = [...filteredData].sort((a, b) => a.size - b.size);
                    break;
                case 'name-asc':
                    sortedData = [...filteredData].sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'name-desc':
                    sortedData = [...filteredData].sort((a, b) => b.name.localeCompare(a.name));
                    break;
                default:
                    sortedData = filteredData;
            }
            
            // æ¸²æŸ“è¡¨æ ¼
            renderDataTable(sortedData);
        }
        
        // æ›´æ–°æ•°æ®è¡¨æ ¼
        function updateDataTable() {
            currentPage = 1;
            filterAndSortData();
        }
        
        // æ¸²æŸ“æ•°æ®è¡¨æ ¼
        function renderDataTable(data) {
            const total = data.length;
            const start = (currentPage - 1) * itemsPerPage;
            const end = Math.min(start + itemsPerPage, total);
            const paginatedData = data.slice(start, end);
            
            // æ›´æ–°åˆ†é¡µä¿¡æ¯
            startItem.textContent = total > 0 ? start + 1 : 0;
            endItem.textContent = end;
            totalItems.textContent = total;
            
            // æ›´æ–°åˆ†é¡µæŒ‰é’®çŠ¶æ€
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = end >= total;
            
            // æ¸…ç©ºè¡¨æ ¼
            dataTableBody.innerHTML = '';
            
            if (paginatedData.length === 0) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = `
                    <td colspan="4" class="px-6 py-10 text-center text-gray-500">
                        <i class="fa fa-search text-4xl mb-3 block opacity-30"></i>
                        <p>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ•°æ®</p>
                    </td>
                `;
                dataTableBody.appendChild(emptyRow);
                return;
            }
            
            // æ¸²æŸ“æ•°æ®è¡Œ
            paginatedData.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                
                // è®¡ç®—ç™¾åˆ†æ¯”
                const percentage = scanResults.totalSize > 0 ? 
                    Math.round((item.size / scanResults.totalSize) * 100) : 0;
                
                // æ ¹æ®å½“å‰è§†å›¾ç±»å‹æ˜¾ç¤ºä¸åŒçš„åˆ—
                let fileCountHtml = '<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>';
                if (currentViewType === 'fileTypes' && item.count !== undefined) {
                    fileCountHtml = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.count.toLocaleString()}</td>`;
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <i class="fa ${getIconForItem(item)} mr-3"></i>
                            <div class="text-sm font-medium text-gray-900 truncate max-w-xs" title="${item.name}">${item.name}</div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${formatBytes(item.size)}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="w-full bg-gray-200 rounded-full h-2 mr-2">
                                <div class="bg-primary h-2 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                            <span class="text-xs text-gray-500 whitespace-nowrap">${percentage}%</span>
                        </div>
                    </td>
                    ${fileCountHtml}
                `;
                
                dataTableBody.appendChild(row);
            });
        }
        
        // è·å–é¡¹ç›®å¯¹åº”çš„å›¾æ ‡
        function getIconForItem(item) {
            switch (currentViewType) {
                case 'fileTypes':
                    if (item.extension) {
                        const ext = item.extension.toLowerCase();
                        if (['jpg', 'jpeg', 'png', 'gif', 'bmp'].includes(ext)) {
                            return 'fa-file-image-o text-primary';
                        } else if (['mp3', 'wav', 'flac'].includes(ext)) {
                            return 'fa-file-audio-o text-secondary';
                        } else if (['mp4', 'avi', 'mkv', 'mov'].includes(ext)) {
                            return 'fa-file-video-o text-accent';
                        } else if (['doc', 'docx'].includes(ext)) {
                            return 'fa-file-word-o text-blue-600';
                        } else if (['xls', 'xlsx'].includes(ext)) {
                            return 'fa-file-excel-o text-green-600';
                        } else if (['ppt', 'pptx'].includes(ext)) {
                            return 'fa-file-powerpoint-o text-red-600';
                        } else if (['pdf'].includes(ext)) {
                            return 'fa-file-pdf-o text-danger';
                        } else if (['zip', 'rar', '7z'].includes(ext)) {
                            return 'fa-file-archive-o text-yellow-600';
                        } else if (['exe'].includes(ext)) {
                            return 'fa-file-exe-o text-red-500';
                        } else if (['txt', 'md'].includes(ext)) {
                            return 'fa-file-text-o text-gray-500';
                        } else if (['js', 'css', 'html', 'php', 'py', 'java', 'c', 'cpp'].includes(ext)) {
                            return 'fa-file-code-o text-purple-600';
                        }
                    }
                    return 'fa-file-o text-gray-400';
                case 'folders':
                    return 'fa-folder text-yellow-500';
                case 'applications':
                    return 'fa-cube text-blue-500';
                default:
                    return 'fa-file-o text-gray-400';
            }
        }
        
        // ç¿»é¡µåŠŸèƒ½
        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                filterAndSortData();
            }
        }
        
        function goToNextPage() {
            const query = searchData.value.toLowerCase();
            let data = [];
            
            // è·å–å½“å‰è§†å›¾ç±»å‹çš„æ•°æ®
            switch (currentViewType) {
                case 'fileTypes':
                    data = scanResults.fileTypes;
                    break;
                case 'folders':
                    data = scanResults.folders;
                    break;
                case 'applications':
                    data = scanResults.applications;
                    break;
            }
            
            // åº”ç”¨è¿‡æ»¤
            const filteredData = data.filter(item => 
                item.name.toLowerCase().includes(query)
            );
            
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                filterAndSortData();
            }
        }
        
        // æ ¼å¼åŒ–å­—èŠ‚æ•°
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB'];
            
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
        
        // åˆ‡æ¢ä¸»é¢˜
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            
            if (isDark) {
                themeToggle.innerHTML = '<i class="fa fa-sun-o text-yellow-400 text-xl transition-all duration-300 pulse-animation"></i>';
                document.body.classList.remove('bg-gradient-to-br', 'from-light', 'to-white');
                document.body.classList.add('dark-mode');
                
                // æ›´æ–°å¯¼èˆªæ æ ·å¼
                document.querySelector('header').classList.add('nav-glass');
                
                // æ›´æ–°å›¾è¡¨å¡ç‰‡æ ·å¼
                document.querySelectorAll('#apps-chart-card, #types-chart-card, #folders-chart-card, #code-lang-chart-card').forEach(el => {
                    el.classList.add('glass-card');
                });
                
                // æ›´æ–°æŒ‰é’®æ ·å¼
                document.querySelectorAll('#scan-button').forEach(el => {
                    el.classList.add('btn-primary');
                });
                document.querySelectorAll('#stop-button').forEach(el => {
                    el.classList.add('btn-danger');
                });
                
                // æ›´æ–°è¿›åº¦æ¡æ ·å¼
                document.querySelector('#scan-progress-bar').classList.add('progress-glow');
                document.querySelector('#scan-percentage').classList.add('text-glow');
                
                // ä¿å­˜ä¸»é¢˜åå¥½
                localStorage.setItem('theme', 'dark');
            } else {
                themeToggle.innerHTML = '<i class="fa fa-moon-o text-dark text-xl transition-all duration-300"></i>';
                document.body.classList.remove('dark-mode');
                document.body.classList.add('bg-gradient-to-br', 'from-light', 'to-white');
                
                // æ¢å¤å¯¼èˆªæ æ ·å¼
                document.querySelector('header').classList.remove('nav-glass');
                
                // æ¢å¤å›¾è¡¨å¡ç‰‡æ ·å¼
                document.querySelectorAll('#apps-chart-card, #types-chart-card, #folders-chart-card, #code-lang-chart-card').forEach(el => {
                    el.classList.remove('glass-card');
                });
                
                // æ¢å¤æŒ‰é’®æ ·å¼
                document.querySelectorAll('#scan-button').forEach(el => {
                    el.classList.remove('btn-primary');
                });
                document.querySelectorAll('#stop-button').forEach(el => {
                    el.classList.remove('btn-danger');
                });
                
                // æ¢å¤è¿›åº¦æ¡æ ·å¼
                document.querySelector('#scan-progress-bar').classList.remove('progress-glow');
                document.querySelector('#scan-percentage').classList.remove('text-glow');
                
                // ä¿å­˜ä¸»é¢˜åå¥½
                localStorage.setItem('theme', 'light');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>